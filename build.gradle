buildscript {
	ext.springBootVersion = 'latest.release'

	repositories {
		mavenCentral()
	}
	dependencies {
		classpath "org.springframework.boot:spring-boot-gradle-plugin:$springBootVersion"
	}
}

apply plugin: 'groovy'
apply plugin: 'org.springframework.boot'

version = '0.0.1-SNAPSHOT'

sourceCompatibility = 1.8
targetCompatibility = 1.8

repositories {
	mavenCentral()
}
dependencies {
	implementation platform("org.springframework.boot:spring-boot-dependencies:$springBootVersion")
	implementation 'org.springframework.boot:spring-boot-starter-web'
	implementation 'org.springframework.boot:spring-boot-starter-actuator'
	implementation 'org.codehaus.groovy:groovy'
	implementation 'org.apache.httpcomponents:httpclient:4.+'
	implementation 'org.apache.commons:commons-lang3:3.+'
	implementation 'io.springfox:springfox-boot-starter:latest.release'
	implementation 'io.springfox:springfox-swagger-ui:latest.release'
}

jar {
	enabled = false
}

bootRun {
	systemProperties = System.properties
}

task bootDockerRun {
	dependsOn bootBuildImage
	doLast {
		"docker run --rm -p 8080:8080 $rootProject.name:$version".execute().waitForProcessOutput(System.out, System.err)
	}
}

task generateProcfile {
	doLast {
		file('Procfile').text = "web: java -Dserver.port=\$PORT -jar ${relativePath(bootJar.archiveFile)}"
	}
}

task stage {
	dependsOn assemble, generateProcfile
}

wrapper {
	distributionType = Wrapper.DistributionType.ALL
	// gradleVersion = new groovy.json.JsonSlurper().parseText('https://services.gradle.org/versions/current'.toURL().text).version
}
